C51 COMPILER V9.60.0.0   SPI                                                               10/30/2023 23:23:21 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN .\OBJ\SPI.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\HardWareCode\SPI.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\UserCode;..\Hard
                    -WareCode;..\UserCode) DEBUG OBJECTEXTEND PRINT(.\LST\SPI.lst) TABS(2) OBJECT(.\OBJ\SPI.obj)

line level    source

   1          
   2          #include <REG_MG82F6D17.h>
   3          #include ".\include\Type.h"
   4          #include ".\include\API_Macro_MG82F6D17.H"
   5          
   6          #include "SPI.h"
   7          
   8          
   9          uint8_t SPI_tranfer(u8 Data)
  10          {
  11   1        SPI_SendData(Data);                 // Send data
  12   1        while(SPI_ChkCompleteFlag()==0);    // Wait complete
  13   1        SPI_ClearCompleteFlag();            // Clear flag
  14   1        return SPI_GetData(); 
  15   1      }
  16          
  17          
  18          void InitSPIPort(void)
  19          {
  20   1        
  21   1        /*
  22   1        PORT_SetP1PushPull(BIT5|BIT7);        // Set P15(MOSI),P17(SPICLK) as push-pull for output
  23   1        PORT_SetP1OpenDrainPu(BIT6);          // Set P16(MISO) as open-drain with pull-high for digital input
  24   1        PORT_SetP3PushPull(BIT3);             // Set P33(nSS) as push-pull for output
  25   1        PORT_P14P15P16P17_HighDrive();  
  26   1        PORT_P1_EnFastDrive(BIT5|BIT6|BIT7);
  27   1        PORT_P3_EnFastDrive(BIT3);
  28   1        */
  29   1        
  30   1      
  31   1      
  32   1        PORT_SetP3PushPull(BIT3|BIT5);//MOSI AND SPICLK
  33   1        PORT_SetP3OpenDrain(BIT4);//MISO
  34   1        PORT_SetP1PushPull(BIT7); //For LedLatch
  35   1        PORT_SetP3PushPull(BIT1); //For DiceLatch
  36   1          
  37   1        PORT_SetP3PushPull(BIT0);//for buzzer
  38   1        P30 = 0;
  39   1        
  40   1        PORT_SetP1OpenDrain(BIT0|BIT1|BIT5|BIT6);//FOR KEY ROW INPUT
  41   1        P10 = 1;
  42   1        P11 = 1;
  43   1        P15 = 1;
  44   1        P16 = 1;
  45   1        PORT_SetP6PushPull(BIT0|BIT1);//for input key colm scaning
  46   1        PORT_SetP2PushPull(BIT2|BIT4);//for input key colm scaning
  47   1        P60 = 0;P61 = 0;P22 = 0;P24 = 0;
  48   1      
  49   1        PORT_P30P31P32P33_HighDrive();
  50   1        PORT_P34P35P36P37_HighDrive();
  51   1        
  52   1        PORT_P3_EnFastDrive(BIT0|BIT1|BIT3|BIT5);
  53   1        PORT_P1_EnFastDrive(BIT7);
  54   1      
C51 COMPILER V9.60.0.0   SPI                                                               10/30/2023 23:23:21 PAGE 2   

  55   1        //PORT_P1_EnFastDrive(BIT0|BIT1|BIT5|BIT6);
  56   1        
  57   1        
  58   1      
  59   1      
  60   1      }
  61          
  62          
  63          void InitSPI(void)
  64          {
  65   1        InitSPIPort();
  66   1        SPI_Enable();                 // Enable SPI
  67   1        SPI_SelectMASTERByMSTRbit();          // Set to MASTER
  68   1        SPI_SetClock(SPI_CLK_SYSCLK_2);         // Set Clock SYSCLK/4 48M/4=12M
  69   1        SPI_SetCPOL_0();                // CPOL=0 
  70   1        SPI_SetDataLSB();               // Data MSB
  71   1        SPI_SetCPHA_0();                // CPHA=1
  72   1        // SPI  nSS/MOSI/MISO/SPICLK IO Port
  73   1        SPI_SetUseP17P35P34P33();     
  74   1      }
  75          
  76          
  77          
  78          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    166    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
